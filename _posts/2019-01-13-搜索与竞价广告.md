---
layout:     post
title:      搜索与竞价广告
subtitle:   《计算广告学》第五章 & 谷歌广告系统
date:       2019-01-13

catalog: true
tags:
    - Computational Advertising
---


> Last updated on 2019-02-08...

### 相关资源整理

- [计算广告论文、学习资料、业界分享](https://github.com/wzhe06/Ad-papers)

### 竞价广告关系图

![](/img/post/20190113/1.jpg)

竞价交易模式的`本质`：将量的约束从交易过程中去除。

### 搜索广告

**具体产品形态**：以上下文查询词为粒度进行受众定向。

**技术特点**：变现能力高、受众定下标签明显（上下文）、展示形式接近自然结果。

**新形势**：
- 丰富文字链创意
- 利用东区对相关性要求较低的特点设计一些拓展广告产品
- 优化广告和自然结果的关系，在保证相关性和广告效果的前提下提高收入

**产品策略**：

![](/img/post/20190113/2.jpg)

- 查询扩展：精确匹配；短语匹配；广泛匹配；否定匹配
- 广告放置：设定北区和东区的进入条件：广告相关性和RPM。

> 产品案例：`Google AdWords`、`淘宝直通车`

### 位置拍卖与机制设计

以搜索广告为代表的竞价广告实际上是像拍卖那样销售广告展示机会。也就是说，系统根据广告主的出价以及由此计算出的 eCPM 决定谁可以得到某次展示的广告位。
- 竞价广告初始阶段：出价是广告主阶段性调整的
- 广告实时交易阶段：广告主可以对每次展示实时调整出价（实时竞价将在第 6 章中介绍）。但是从拍卖市场的宏观角度看，这两种竞价没有本质差别

让我们先来看看怎样描述竞价广告问题，并从宏观市场的角度了解一些重要结论。如下图所示，假设有一组广告位可以被占用，将这些广告位按照其经验价值排名，分别记为 s=1，2，···，S（对横幅广告而言，这里的 S 一般为 1）。

在某次广告请求中，有一组广告 a=1，2，···，A 出价参与拍卖，每个广告的出价记为 b<sub>a</sub>，系统将前 S 个高出价的广告依次放到前面排序好的 S 个广告位上，这样的问题称为位置拍卖（position auction）。

根据前文的讨论，当某个广告 a 被放在 s 位置上时，其**期望收益**即`eCPM`为 r<sub>as</sub>=µ<sub>s</sub>ν<sub>a</sub>。

这里我们作了一些**假设**，比如，`点击率 µ`仅与`位置 s`有关，而`点击价值 ν`仅与`广告 a`有关，这些假设在搜索广告给定某具体关键词的情形下可以说基本合理，对于展示广告的情形虽然非常近似，但并不太影响对竞价问题宏观市场的讨论。

**位置拍卖问题示例图**：

![](/img/post/20190113/3.png)

#### 定价问题

在定价问题上，我们在微观上的直觉未必可以推广到宏观市场。从整个市场的角度来看，我们重点需要研究的是市场处于`稳定状态`下的收益和其他特性。

而所谓`稳定`，指的是整个竞价系统处于`纳什均衡（Nash equilibrium）状态`，也即每个广告主都通过出价得到了最符合自己利益的位置。

对某一次位置竞价来说，其对称`纳什均衡（symmetric Nashequilibrium）状态`可以表示为下式：

![](/img/post/20190113/4.png)

在线广告竞价市场最常见的定价策略是 GSP （广义第二高价）方案；另外有一种 VCG（Vickrey-Clarke-Groves）定价策略。

#### GSP

通俗理解：
- 出价最高者赢得拍卖，但它只需要付出第二名出价的钱
- 比如阿迪出10块，耐克出价5块，那么阿迪赢得广告展示，但它只需要支付5块
- 这一机制看起来违反直觉，但它却是从博弈论的角度是一个极其理性的设计

**第二高价**：指的是在只有一个位置的拍卖中，向赢得该位置的广告主收取其下一位广告主的出价，这样的拍卖也叫作 Vickrey拍卖。

**广义第二高价**：在搜索广告这种有多个位置的拍卖过程中，很容易直觉地将第二高价策略推广成下面的策略：对赢得每一个位置的广告主，都按照他下一位的广告位置出价来收取费用。

如果是按照 CPM 结算，那么广义第二高价可以非常直接地应用。

然而在 CPC 结算的竞价广告系统中，广告主的出价是针对点击的，而竞价是针对 eCPM 的，因此要对两者换算一下以实现 CPC 情形下的广义第二高价，其定价公式如下：

![](/img/post/20190113/5.png)

> 如今，包括谷歌、百度在内的众多广告平台均采用这一机制。

#### VCG

VCG 定价是 Vickrey、Clarke 和 Groves 在研究竞价系统均衡状态时得到的一种理论上较为优越的定价策略。

其基本思想是：对于赢得了某个位置的广告主，其所付出的成本应该等于他占据这个位置给其他市场参与者带来的价值损害。

在这一原则下，VCG的定价策略可以表示为公式：

![](/img/post/20190113/6.png)

> Facebook 在实际的竞价广告系统中就采用了这一定价机制。

#### 对比分析

虽然理论上比 GSP 更合理，但是由于原理较复杂，向广告主解释起来有难度，因此在实际系统中采用的并不多。

VCG定价策略直觉上的合理性很容易理解。理论分析表明，VCG 定价策略的优越性体现在如下几个方面：
- 首先，在这种定价策略的稳定状态下，整个市场是 truth-telling 的。所谓 truth-telling，可以理解为每个广告主都找到了自己的最优状态
- 其次，相对于其他的定价策略，这种定价向广告主收取的费用是最少的。在单广告位拍卖的情形下，VCG 定价策略就退化为第二高价策略

虽然有以上诸多的优点，VCG 定价在竞价广告中却并不是一种主流的方式。
- 这主要是由于这种定价方式的逻辑过于复杂，比较难以向广告主解释清楚
- 另外在广告主和媒体存在博弈关系的情形下，媒体是否正确地计算了“给其他市场参与者带来的价值损害”也很难验证

#### 价格挤压

能够根据市场情况更主动地影响竞价体系向着需要的方向发展。

在 CPC 结算的广告产品中，eCPM 可以表示成点击率和出价的乘积，即 r=µ·ν=µ·bid CPC 。但是在竞价的机制设计中，有时会对此公式做一些微调，把它变成下面的形式：

![](/img/post/20190113/7.png)

其中的κ为一个大于 0 的实数。可以考虑两种极端情况来理解κ的作用：
- 当κ→∞时，相当于只根据点击率来排序而不考虑出价的作用
- 当κ→0时，则相当于只根据出价来排序

因此，随着κ的增大，相当于我们在挤压出价在整个竞价体系中的作用，因此我们把这个因子叫做价格挤压（squashing）因子。

#### 定价结果示例

![](/img/post/20190113/8.png)

从上表的例子中可以看出，经过GSP 的 CPC 定价并不是降序的，并且存在低于 MRP（如第 3 位的广告）的情形，这时需要将其强制设为 MRP；另外，κ会对排序和计价都有明显的影响。

#### 代码描述

上节介绍了位置拍卖市场中一些常用的定价策略，包括 GSP、MRP、价格挤压等，单独理解这些策略都不困难。

在实际的系统中，需要将这几种策略综合起来执行。以按 CPC计价的竞价广告产品中一次广告展示为例，我们将实际的计价算法用下面的代码描述：

![](/img/post/20190113/9.png)

### 谷歌广告系统

#### 广告质量分

谷歌开创性地将CPC推广为主流的竞价方式，广告主只需要为点击进行出价。

为此，谷歌倚仗自己的技术优势引入了“广告质量分”这一概念，质量分的统计维度包括广告的点击率、和关键词的广告性、落地页的质量、广告主历史表现等多个维度进行综合评估。

广告能否胜出取决于出价和质量分两个因素，即如果广告质量差，即便出更高的价格，排名也可能排在最后。

当然，这里涉及非常多的技术因素，比如要计算质量分其中就要知道点击率，那么在投放之前，点击率是无法知道的，就必须要对点击率进行预测，光点击率预测这一模块，就会有一个极其庞大的技术团队进行支撑。

> 拼多多创始人黄峥、小红书CTO郄小虎之前都是谷歌广告部门的成员，也正是这些顶尖人才持续地优化才使得该系统效率如此之高。

> 据郄小虎称谷歌的综合点击高达3%-4%，而首页首位的点击率通常高达30%-40%，这是一个特别恐怖的数字。

#### YouTube可跳过广告

首先它用跳过按钮解决了前5秒的用户到达问题、其次它增加了一种有效的直接来监测广告的优劣，再次它只为真实播放付费解决了广告主预算控制的问题，最后通过底层竞价机制优化了广告质量，这一设计极其精妙地解决了广告主利益、平台利益和用户的利益，真正做到了三赢。

#### 广告屏蔽插件

类似的案例还很多，比如作为作为一个广告平台，谷歌当然不希望用户屏蔽广告，但事实上在谷歌的Chrome浏览器中，Adblock这类广告屏蔽插件畅通无阻，而Adblock如今已经累计收获了4000万的用户，**那么谷歌为什么对这类广告屏蔽插件视而不见呢？**

谷歌的逻辑是，**那些安装浏览器插件的用户本身就对广告不够感兴趣，相当于安装屏蔽插件这一行为本身为谷歌进行了一次人工受众的筛选**，这反而能提升不进行筛选之前的广告效果。

**谷歌“不作恶”的理念指导下，谷歌会在明显的位置标注出广告的标识**，以便用户能明确识别广告，同时谷歌会有完善的负反馈机制，当你点击不再显示广告时，会明确弹出负反馈的原因——“内容不当”、“重复”、“不相关”供用户选择，同时也会明显告知谷歌是根据哪些信息对你投放的广告。

#### 移动时代

从PC到移动的转型过程中，伴随的信息结构的变迁，PC时代，互联网信息以网站的形式存在，以一个通用的HTTP协议可以自由访问，于是浏览器、搜索成为入口，谷歌牢固地掌握了这两个入口，而**在移动时代，信息变成了一个个的孤岛，背后是不能互联互通的无数个APP，这时候搜索的重要性就下降了！**

让谷歌在移动时代领先的重要因素是其超凡的远见——2006年收购了YouTube，2005年收购了安迪*鲁宾的安卓，如今，YouTube在谷歌强大的技术、资金和推荐算法的加持下已成为全球网民一个重要的娱乐入口，也是谷歌展示广告最重要的组成部分，源源不断为谷歌贡献收入。

而安卓系统的战略意义不言而喻，当年只花5000万美金收购不到60人的安卓团队为谷歌巩固在移动时代的优势立下了汗马功劳，有了安卓这个开放的系统，除苹果之外的所有智能手机的默认搜索变成了谷歌，而为此安卓不需要付一分钱，要知道据Bernstein研究公司分析师预计，为了让所有售出的iPhone的默认搜索引擎设置成谷歌，谷歌每年要付给苹果30亿美金。

安卓的生态无疑给谷歌广告收入带来极其强劲的影响，谷歌Play商店成为安卓手机安装新APP的入口和默认选项，谷歌以此在自己的广告系统推出了UAC（通用应用程序系列广告），专门针对APP类广告进行了专门的全流程优化，和通常Adwords按点击进行计费不同，UAC支持按安装、使用、付费等多个维度优化应用广告。

UAC的优势在于它是谷歌专门针对APP类的应用推广方案，由于谷歌对安卓生态的数据有着天然的优势，结合相关工具和广告主自己的优化目标，通过机器学习自动地帮APP类客户找到合适的潜在客户，对应用开发者而言，如果要在安卓生态上推广，谷歌广告已然是极其重要的选项。

如今数字广告市场，APP类广告已占据重要的支出份额，而谷歌在这一领域依靠极具远见的产品策略而继续高歌猛进，相反，国内的百度则没有那么幸运，当年居BAT之首的百度在移动时代建树寥寥，在产品上止步不前，完全没有安卓、Chrome、谷歌Play等类似的护城河从而在新的竞争中掉队。

### 引申阅读

- 微信公众号：卫夕指北
- [《从央视到谷歌：聊一聊竞价广告的机制设计》](https://mp.weixin.qq.com/s?__biz=MzU1NjEzNjk1Mw==&mid=2247484031&idx=1&sn=c76a802df8a10484eb3feac6a4ac28a5&chksm=fbc8e2e9ccbf6bff574e417a6a27e3aba4290edd4efe08b2dea94633b4efe23cbf43a42f3454&scene=21#wechat_redirect)
- [《机器知道你会点广告：写给普通人的CTR预估科普》](https://mp.weixin.qq.com/s?__biz=MzU1NjEzNjk1Mw==&mid=2247484091&idx=1&sn=c2c88feaf76786a1a121213af5e2fe31&chksm=fbc8e22dccbf6b3b2b13e6f0701ebe743f0b8f8a44e299744631f8db2f8c879bdde54346c66c&scene=21#wechat_redirect)
- [《细思极恐的YouTube可跳过广告》](https://mp.weixin.qq.com/s?__biz=MzU1NjEzNjk1Mw==&mid=2247483667&idx=1&sn=bf9dbce5ed6e63fe7b84fa772371602a&chksm=fbc8e185ccbf689355daa689a858a120ee94559568240eb167e4c836fdd67c5139df769f2653&scene=21#wechat_redirect)
- [《阿里妈妈：定向广告新一代点击率预估主模型——深度兴趣演化网络》](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247487620&idx=1&sn=b3162fec93608788430f7e52236d998e&chksm=fbd4a2e8cca32bfea69c4e418e38d0c8709d2fe3395f74f73aaf48815ec8a41fc0d130ae4a1e&mpshare=1&scene=23&srcid=0129x9xxUUalmMVT9goaeEEi#rd)
